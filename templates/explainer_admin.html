<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Explainers</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Manage Explainers</h1>
        <a href="{{ url_for('explainer') }}" class="btn btn-secondary mb-3">
            <i class="bi bi-arrow-left"></i> Back to Explainers
        </a>

        <div class="card mb-4">
            <div class="card-header">
                <h3>Add/Edit Explainer</h3>
            </div>
            <div class="card-body">
                <form id="explainer-form" method="post">
                    <input type="hidden" name="id" id="explainer-id">
                    <div class="mb-3">
                        <label for="title" class="form-label">Title</label>
                        <input type="text" name="title" id="title" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="content" class="form-label">Content</label>
                        <div id="editor" style="height: 200px;"></div>
                        <input type="hidden" name="content" id="content">
                    </div>
                    <div class="mb-3">
                        <label for="image_url" class="form-label">Image URL</label>
                        <input type="url" name="image_url" id="image_url" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="video_url" class="form-label">YouTube Video URL</label>
                        <input type="url" name="video_url" id="video_url" class="form-control">
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-danger" id="delete-btn" style="display:none;">Delete</button>
                </form>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Existing Explainers</h3>
            </div>
            <ul class="list-group list-group-flush">
                {% for explainer in explainers %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    {{ explainer.title }}
                    <button class="btn btn-sm btn-outline-primary" data-explainer='{{ explainer|tojson }}' onclick="editExplainer(this)">
                        <i class="bi bi-pencil"></i> Edit
                    </button>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        const quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline', 'strike'],
                    [{ 'color': [] }, { 'background': [] }],
                    [{ 'align': [] }],
                    ['link', 'image', 'video'],
                    ['clean']
                ]
            }
        });

        const form = document.getElementById('explainer-form');
        const contentInput = document.getElementById('content');
        const idInput = document.getElementById('explainer-id');
        const deleteBtn = document.getElementById('delete-btn');

        form.addEventListener('submit', function() {
            contentInput.value = quill.root.innerHTML;
        });

        function editExplainer(button) {
            const explainer = JSON.parse(button.getAttribute('data-explainer'));
            idInput.value = explainer.id;
            document.getElementById('title').value = explainer.title;
            quill.root.innerHTML = explainer.content || '';
            document.getElementById('image_url').value = explainer.image_url || '';
            document.getElementById('video_url').value = explainer.video_url || '';
            deleteBtn.style.display = 'inline-block';
            window.scrollTo(0, 0);
        }

        deleteBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to delete this explainer?')) {
                const deleteForm = document.createElement('form');
                deleteForm.method = 'post';
                deleteForm.action = '{{ url_for("explainer_admin_delete") }}';
                const idHidden = document.createElement('input');
                idHidden.type = 'hidden';
                idHidden.name = 'id';
                idHidden.value = idInput.value;
                deleteForm.appendChild(idHidden);
                document.body.appendChild(deleteForm);
                deleteForm.submit();
            }
        });
    </script>
</body>
</html>